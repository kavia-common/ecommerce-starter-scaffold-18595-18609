{"is_source_file": true, "format": "TypeScript", "description": "This file defines the CartStoreService class, an Angular service responsible for managing shopping cart state, including loading, adding, updating, removing items, and persisting cart information via an API and localStorage.", "external_files": ["../models/api.models", "./api-client.service"], "external_methods": ["ApiClientService.createCart", "ApiClientService.getCart", "ApiClientService.addItem", "ApiClientService.updateItemQuantity", "ApiClientService.removeItem", "ApiClientService.clearCart"], "published": ["CartStoreService"], "classes": [{"name": "CartStoreService", "description": "An Angular service that manages shopping cart state using signals, effects, and an API client."}], "methods": [{"name": "ensureCartLoaded", "description": "Ensures a shopping cart exists, creating one if necessary, and loads its data."}, {"name": "addToCart", "description": "Adds a product with specified quantity to the cart, creating a cart if needed."}, {"name": "updateQuantity", "description": "Updates the quantity of a specific product in the cart."}, {"name": "removeItem", "description": "Removes a product from the cart."}, {"name": "clear", "description": "Clears all items from the cart and resets local state."}, {"name": "reset", "description": "Drops the cart id and resets local cart state (useful after checkout)."}, {"name": "setError", "description": "Sets an error message in the cart service state."}], "calls": ["this.api.createCart", "this.api.getCart", "this.api.addItem", "this.api.updateItemQuantity", "this.api.removeItem", "this.api.clearCart"], "search-terms": ["Angular CartStoreService", "localStorage cart id", "RxJS switchMap", "cart signals", "cart management"], "state": 2, "file_id": 27, "knowledge_revision": 84, "git_revision": "c34fcd6693fb7b4a144772fe12cd1de7a0f9fa7c", "ctags": [{"_type": "tag", "name": "CartLoadState", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^type CartLoadState = 'idle' | 'loading' | 'error';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "CartStoreService", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^export class CartStoreService {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "LocalStorageLike", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^    type LocalStorageLike = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "c", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^    const c = this.cartSignal();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cartId", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^    const cartId = this.cartIdSignal();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cartIdKey", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^  private readonly cartIdKey = 'ecom_cart_id_v1';$/", "language": "TypeScript", "kind": "property", "scope": "CartStoreService", "scopeKind": "class"}, {"_type": "tag", "name": "cartIdSignal", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^  private readonly cartIdSignal = signal<number | null>(null);$/", "language": "TypeScript", "kind": "property", "scope": "CartStoreService", "scopeKind": "class"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^        const current = this.cartSignal();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ensure$", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^    const ensure$ = cartId$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "existingId", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^    const existingId = this.cartIdSignal();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^      const id = this.cartIdSignal();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "obs", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^    const obs = existingId ? of({ cart_id: existingId }) : this.api.createCart();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^      const raw = storage?.getItem(this.cartIdKey) ?? null;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "storage", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^        const storage = (globalThis as unknown as { localStorage?: LocalStorageLike }).localStor/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "storage", "path": "/home/kavia/workspace/code-generation/ecommerce-starter-scaffold-18595-18609/ecommerce_frontend/src/app/services/cart-store.service.ts", "pattern": "/^      const storage = (globalThis as unknown as { localStorage?: LocalStorageLike }).localStorag/", "language": "TypeScript", "kind": "constant"}], "hash": "4327940dcaa2ffd70283c12c024f8717", "format-version": 4, "code-base-name": "ecommerce_frontend", "filename": "ecommerce_frontend/src/app/services/cart-store.service.ts", "fields": [{"name": "private readonly cartIdKey = 'ecom_cart_id_v1';", "scope": "CartStoreService", "scopeKind": "class", "description": "unavailable"}, {"name": "private readonly cartIdSignal = signal<number | null>(null);", "scope": "CartStoreService", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"84": "c34fcd6693fb7b4a144772fe12cd1de7a0f9fa7c"}]}